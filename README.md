# Тестовое задание КБ Стрелка

## Предисловие

На собеседовании я упоминал что использовал Scrapy только во время обучения, поэтому решил что наиболее уместно реализовать тестовое именно на нём. В этом фреймворке я новичок, но за тестовое, на мой взгляд, основные функции я освоил

## Структура проекта
За исключением директории venv_strelka содержащей виртуальное окружение, в остальном структура стандартная для проектов Scrapy:
- spiders/hotel_list_spider.py содержит объект класса Spider ответственный непосредственно за сбор данных
- pipelines.py содержит класс StrelkaTestcasePipeline ответственный за загрузку данных в бд
- items.py содержит схему данных
- settings.py содержит общие настройки проекта
- middlewares.py дефолтный для Scrapy, без изменений

## Логика сбора данных

Для сбора информации была выбрана наполовину родная мне Калужская область, на вход в spider подаётся страница с уже заданными параметрами для поиска именно по Калужской области

Внутри класса HotelsListSpider за сбор данных отвечают два метода:
- parse собирает ссылки на все объекты на странице и переходит по всем страницам в категории
- prase_hotel_page собирает данные внутри ссылки на конкретный объект

## Логика загрузки данных в БД

В БД предварительно была создана следующая таблица:
```
create table hotels (
	id serial primary key,
	hotel VARCHAR ( 255 ) not null,
	type VARCHAR ( 255 ),
	legal_entity_name VARCHAR ( 255 ),
	region VARCHAR ( 255 ),
	inn VARCHAR ( 50 ),
	ogrn VARCHAR ( 50 ),
	address VARCHAR ( 255 ),
	phone_number VARCHAR ( 50 ),
	email VARCHAR ( 50 ),
	site_url VARCHAR ( 255 ),
	classification VARCHAR ( 50 )
)
```

Непосредственно логика загрузки описана в файле pipelines.py и реализуется в три шага:
1) При запуске паука создаётся подключение к БД с помощью psycorg2
2) При обработке каждой страницы формируется строка которая загружается в таблицу hotels в БД
3) При окончании работы паука подключение тоже закрывается

## Воспроизведение

Кроме стандартных библиотек сопровождающих ядро python использовался только непосредственно фреймворк Scrapy и psycopg2-binary (установлены в venv в директории strelka_venv)
